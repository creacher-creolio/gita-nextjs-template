# Internationalization (i18n) Setup Guide

This document explains the internationalization setup using `next-intl` in this Next.js application.

## Overview

The application now supports multiple languages:
- English (en) - Default
- Spanish (es)
- French (fr)
- German (de)

## Architecture

### Folder Structure

```
app/
â”œâ”€â”€ [locale]/                 # Dynamic locale routing
â”‚   â”œâ”€â”€ layout.tsx            # Locale-specific layout
â”‚   â”œâ”€â”€ page.tsx              # Home page with translations
â”‚   â”œâ”€â”€ auth/                 # Authentication pages
â”‚   â”‚   â”œâ”€â”€ login/
â”‚   â”‚   â”œâ”€â”€ sign-up/
â”‚   â”‚   â”œâ”€â”€ forgot-password/
â”‚   â”‚   â””â”€â”€ update-password/
â”‚   â””â”€â”€ protected/            # Protected pages
â”‚       â”œâ”€â”€ layout.tsx
â”‚       â”œâ”€â”€ page.tsx
â”‚       â””â”€â”€ todos/
â”œâ”€â”€ layout.tsx                # Root layout (minimal)
â””â”€â”€ page.tsx                  # Root redirect

i18n/
â”œâ”€â”€ routing.ts                # Locale routing configuration
â”œâ”€â”€ navigation.ts             # Internationalized navigation
â””â”€â”€ request.ts                # Request configuration

messages/
â”œâ”€â”€ en.json                   # English translations
â”œâ”€â”€ es.json                   # Spanish translations
â”œâ”€â”€ fr.json                   # French translations
â””â”€â”€ de.json                   # German translations

components/
â””â”€â”€ locale-switcher.tsx       # Language switcher component
```

### Configuration Files

#### 1. `i18n/routing.ts`
Defines supported locales and default locale:
```typescript
export const routing = defineRouting({
    locales: ["en", "es", "fr", "de"],
    defaultLocale: "en",
});
```

#### 2. `i18n/navigation.ts`
Creates internationalized navigation components:
```typescript
export const { Link, redirect, usePathname, useRouter, getPathname } = createNavigation(routing);
```

#### 3. `i18n/request.ts`
Configures message loading per request:
```typescript
export default getRequestConfig(async ({ requestLocale }) => {
    let locale = await requestLocale;

    if (!locale || !routing.locales.includes(locale as any)) {
        locale = routing.defaultLocale;
    }

    return {
        locale,
        messages: (await import(`../messages/${locale}.json`)).default,
    };
});
```

### Translation Files

Translation files are organized by locale in the `messages/` directory. Each file contains nested objects for different sections:

```json
{
    "metadata": {
        "title": "Create Next App",
        "description": "Generated by create next app"
    },
    "home": {
        "title": "Next.js Supabase Starter",
        "authStatus": {
            "welcomeBack": "Welcome back!",
            "loggedInAs": "Logged in as {email}"
        }
    },
    "auth": {
        "login": {
            "title": "Sign In",
            "email": "Email"
        }
    }
}
```

## URL Structure

The application uses locale-based routing:

- `/` â†’ Redirects to `/en`
- `/en` â†’ English version
- `/es` â†’ Spanish version
- `/fr` â†’ French version
- `/de` â†’ German version

Examples:
- `/en/auth/login` â†’ English login page
- `/es/auth/login` â†’ Spanish login page
- `/fr/protected` â†’ French protected page

## Usage in Components

### Server Components
Use `getTranslations` for server-side rendering:

```typescript
import { getTranslations } from "next-intl/server";

export default async function HomePage() {
    const t = await getTranslations("home");
    const tAuth = await getTranslations("home.authStatus");

    return (
        <div>
            <h1>{t("title")}</h1>
            <p>{tAuth("welcomeBack")}</p>
        </div>
    );
}
```

### Client Components
Use `useTranslations` hook:

```typescript
"use client";
import { useTranslations } from "next-intl";

export function LoginForm() {
    const t = useTranslations("auth.login");

    return (
        <form>
            <h1>{t("title")}</h1>
            <input placeholder={t("email")} />
        </form>
    );
}
```

### Navigation
Always use the internationalized `Link` component:

```typescript
import { Link } from "@/i18n/navigation";

export function Navigation() {
    return (
        <nav>
            <Link href="/auth/login">Login</Link>
            <Link href="/protected">Dashboard</Link>
        </nav>
    );
}
```

## Language Switching

The `LocaleSwitcher` component allows users to change languages:

```typescript
import { LocaleSwitcher } from "@/components/locale-switcher";

export function Header() {
    return (
        <header>
            <LocaleSwitcher />
        </header>
    );
}
```

The component:
- Shows current language with flag
- Provides dropdown with all available languages
- Preserves current route when switching languages
- Uses transitions for smooth UX

## Metadata Internationalization

Metadata is internationalized in the locale layout:

```typescript
export async function generateMetadata({ params }: { params: Promise<{ locale: string }> }): Promise<Metadata> {
    const { locale } = await params;
    const t = await getTranslations({ locale, namespace: "metadata" });

    return {
        title: t("title"),
        description: t("description"),
    };
}
```

## Middleware Integration

The middleware combines next-intl with Supabase authentication:

```typescript
import createMiddleware from "next-intl/middleware";
import { updateSession } from "@/lib/supabase/middleware";

const intlMiddleware = createMiddleware(routing);

export async function middleware(request: NextRequest) {
    // Apply internationalization first
    const intlResponse = intlMiddleware(request);

    // Then apply Supabase session middleware
    const response = await updateSession(request);

    // Use intl response if it's a redirect
    if (intlResponse.status !== 200) {
        return intlResponse;
    }

    return response;
}
```

## Adding New Languages

To add a new language:

1. Add the locale code to `i18n/routing.ts`:
   ```typescript
   locales: ["en", "es", "fr", "de", "ja"], // Added Japanese
   ```

2. Create a new translation file in `messages/`:
   ```
   messages/ja.json
   ```

3. Add the language to the locale switcher:
   ```typescript
   const locales = [
       // ... existing locales
       { code: "ja", name: "æ—¥æœ¬èªž", flag: "ðŸ‡¯ðŸ‡µ" },
   ];
   ```

## Best Practices

### 1. Consistent Key Structure
Use nested objects for organization:
```json
{
    "section": {
        "subsection": {
            "key": "Translation"
        }
    }
}
```

### 2. Parameterized Translations
Use placeholders for dynamic content:
```json
{
    "welcome": "Welcome, {name}!"
}
```

Usage:
```typescript
t("welcome", { name: user.name })
```

### 3. Namespace Organization
Group related translations:
- `metadata` - Page metadata
- `home` - Homepage content
- `auth` - Authentication forms
- `protected` - Protected area content
- `common` - Shared UI elements

### 4. Static Rendering
Enable static rendering for better performance:
```typescript
export function generateStaticParams() {
    return routing.locales.map((locale) => ({ locale }));
}
```

## Troubleshooting

### Common Issues

1. **Missing translations**: Check console for missing key warnings
2. **Route not found**: Ensure all pages are moved to `[locale]` directory
3. **Link not working**: Use `@/i18n/navigation` Link instead of Next.js Link
4. **Middleware conflicts**: Ensure proper order in middleware stack

### Debug Mode
Enable debug mode in development:
```javascript
// In request.ts
export default getRequestConfig(async ({ requestLocale }) => {
    return {
        locale,
        messages: (await import(`../messages/${locale}.json`)).default,
        onError: (error) => console.error('i18n error:', error),
    };
});
```

## Performance Considerations

- Translation files are lazy-loaded per locale
- Static generation reduces runtime translation costs
- Middleware efficiently handles locale detection
- Client-side navigation preserves loaded translations

This setup provides a robust, scalable internationalization system that integrates seamlessly with the existing Supabase authentication and Next.js App Router architecture.
